(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();const E={baseUrl:"https://mesto.nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"6874ea7c-fdda-46c4-ad6e-6750714638d0","Content-Type":"application/json"}};async function c(e,t){return fetch(`${E.baseUrl}${e}`,{...t,headers:E.headers}).then(r=>r.ok?r.json():Promise.reject(`Ошибка ${r.status}`))}const O=()=>c("/users/me",{method:"GET"}),$=e=>c("/users/me",{method:"PATCH",body:JSON.stringify(e)}),N=e=>c("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})}),U=()=>c("/cards",{method:"GET"}),M=e=>c("/cards",{method:"POST",body:JSON.stringify(e)}),F=e=>c(`/cards/${e}`,{method:"DELETE"}),j=e=>c(`/cards/likes/${e}`,{method:"DELETE"}),V=e=>c(`/cards/likes/${e}`,{method:"PUT"}),J=document.querySelector("#card-template").content.querySelector(".card"),v=e=>e.some(({_id:t})=>t===globalThis.userData._id),w=(e,t)=>{const r=e.querySelector(".card__like-button"),n=e.querySelector(".card__like-count"),o=v(t)?"add":"remove";n.textContent=t.length,r.classList[o]("card__like-button_is-active")};async function G(e,t){if(!confirm("Вы действительно хотите удалить карточку?")){console.warn(`Удаление карточки с id ${e} отменено.`);return}try{const{message:n}=await F(e);t.remove(),console.log(`%c${n}`,"color: green")}catch(n){console.error("Произошла ошибка при удалении карточки:",n)}}async function H(e,t){try{const{likes:r}=v(e.likes)?await j(e._id):await V(e._id);e.likes=r,w(t,r)}catch(r){console.error(`Произошла ошибка при ${v?"удалении лайка с":"лайке"} карточки:`,r)}}function z({data:e,openImage:t}){const r=J.cloneNode(!0),n=r.querySelector(".card__like-button"),o=r.querySelector(".card__title"),s=r.querySelector(".card__image");if(s.src=e.link,o.textContent=e.name,s.alt=e.name,w(r,e.likes),globalThis.userData._id===e.owner._id){const a=r.querySelector(".card__delete-button");a.classList.add("card__delete-button_visible"),a.addEventListener("click",()=>G(e._id,r))}return s.addEventListener("click",()=>t(s)),n.addEventListener("click",()=>H(e,r)),r}function p(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",D)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",D)}function D(e){if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");l(t)}}const K=(e,t,r)=>{const n=e.nextElementSibling;e.classList.add(r.inputErrorClass),n.classList.add(r.errorClass),n.textContent=t},B=(e,t)=>{const r=e.nextElementSibling;e.classList.remove(t.inputErrorClass),r.classList.remove(t.errorClass),r.textContent=""},Q=(e,t)=>{const{patternMismatch:r,valid:n}=e.validity,o=r?e.dataset.errorMessage:"";e.setCustomValidity(o),n?B(e,t):K(e,e.validationMessage,t)},h=(e,t,{inactiveButtonClass:r})=>{const n=e.some(({validity:{valid:s}})=>!s),o=n?"add":"remove";t.disabled=n,t.classList[o](r)},R=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);h(r,n,t),r.forEach(o=>{o.addEventListener("input",()=>{Q(o,t),h(r,n,t)})})},W=e=>{[...document.querySelectorAll(e.formSelector)].forEach(r=>{r.addEventListener("submit",n=>n.preventDefault()),R(r,e)})},L=(e,t)=>{const r=[...e.querySelectorAll(t.inputSelector)],n=e.querySelector(t.submitButtonSelector);r.forEach((o,s)=>{B(o,s),o.value=""}),h(r,n,t)},X=document.querySelectorAll(".popup");X.forEach(e=>{e.classList.add("popup_is-animated"),e.addEventListener("click",t=>{(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&l(e)})});function i(e,t){e.textContent=t?"Сохранение...":"Сохранить"}const Y=document.querySelector(".profile__edit-button"),Z=document.querySelector(".profile__title"),ee=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),_=document.querySelector(".popup_type_edit"),d=_.querySelector(".popup__form"),k=_.querySelector(".popup__button"),b=d.querySelector(".popup__input_type_name"),g=d.querySelector(".popup__input_type_description");Y.addEventListener("click",function(){L(d,S),b.value=globalThis.userData.name,g.value=globalThis.userData.about;const e=new InputEvent("input",{inputType:"insertText"});b.dispatchEvent(e),g.dispatchEvent(e),p(_)});async function te(e){e.preventDefault();try{i(k,!0);const t=await $({name:b.value,about:g.value});q(t)}catch(t){console.error("Ошибка при редактировании профиля:",t)}finally{i(k,!1),d.reset(),l(_)}}function q(e){globalThis.userData=e,Z.textContent=e.name,ee.textContent=e.about,x.style.backgroundImage=`url(${e.avatar})`}d.addEventListener("submit",te);const m=document.querySelector(".popup_type_edit-profile-image"),y=m.querySelector(".popup__form"),I=m.querySelector(".popup__button"),re=y.querySelector(".popup__input_type_url_image");x.addEventListener("click",function(){L(y,S),p(m)});async function oe(e){e.preventDefault();try{i(I,!0);const t=await N(re.value);q(t),y.reset(),l(m)}catch(t){console.error("Ошибка при редактировании аватара профиля:",t)}finally{i(I,!1)}}y.addEventListener("submit",oe);const ne=document.querySelector(".profile__add-button"),f=document.querySelector(".popup_type_new-card"),u=f.querySelector(".popup__form"),P=f.querySelector(".popup__button"),se=u.querySelector(".popup__input_type_card-name"),ce=u.querySelector(".popup__input_type_url");ne.addEventListener("click",()=>p(f));async function ae(e){e.preventDefault();try{i(P,!0);const t=await M({name:se.value,link:ce.value});A(t),l(f),u.reset(),L(u,S)}catch(t){console.error("Ошибка при создании карточки:",t)}finally{i(P,!1)}}u.addEventListener("submit",ae);const C=document.querySelector(".popup_type_image"),T=C.querySelector(".popup__image"),ie=C.querySelector(".popup__caption");function ue(e){T.src=e.src,T.alt=e.alt,ie.textContent=e.alt,p(C)}const le=document.querySelector(".places__list");function A(e){const t=z({data:e,openImage:ue});le.prepend(t)}function de(e){e.reverse().forEach(A)}const S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};W(S);Promise.all([U(),O()]).then(([e,t])=>{q(t),de(e)}).catch(console.error);
