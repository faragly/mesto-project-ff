(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();const M=document.querySelector("#card-template").content.querySelector(".card"),b=e=>e.some(({_id:t})=>t===globalThis.userData._id),I=(e,t)=>{const o=e.querySelector(".card__like-button"),s=e.querySelector(".card__like-count"),r=b(t)?"add":"remove";s.textContent=t.length,o.classList[r]("card__like-button_is-active")};function F({data:e,deleteCard:t,openImage:o,likeCard:s,unlikeCard:r}){const n=M.cloneNode(!0),i=n.querySelector(".card__like-button"),N=n.querySelector(".card__title"),p=n.querySelector(".card__image");if(p.src=e.link,N.textContent=e.name,p.alt=e.name,I(n,e.likes),globalThis.userData._id===e.owner._id){const a=n.querySelector(".card__delete-button");a.classList.add("card__delete-button_visible"),a.addEventListener("click",async()=>{if(!confirm("Вы действительно хотите удалить карточку?")){console.warn(`Удаление карточки с id ${e._id} отменено.`);return}try{const{message:h}=await t(e._id);n.remove(),console.log(`%c${h}`,"color: green")}catch(h){console.error("Произошла ошибка при удалении карточки:",h)}})}return p.addEventListener("click",()=>o(p)),i.addEventListener("click",async()=>{try{const{likes:a}=b(e.likes)?await r(e._id):await s(e._id);e.likes=a,I(n,a)}catch(a){console.error(`Произошла ошибка при ${b?"удалении лайка с":"лайке"} карточки:`,a)}}),n}function _(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",D)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",D)}function D(e){if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");l(t)}}const j=(e,t,o)=>{const s=e.nextElementSibling;e.classList.add(o.inputErrorClass),s.classList.add(o.errorClass),s.textContent=t},A=(e,t)=>{const o=e.nextElementSibling;e.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""},V=(e,t)=>{const{patternMismatch:o,valid:s}=e.validity,r=o?e.dataset.errorMessage:"";e.setCustomValidity(r),s?A(e,t):j(e,e.validationMessage,t)},g=(e,t,{inactiveButtonClass:o})=>{const s=e.some(({validity:{valid:n}})=>!n),r=s?"add":"remove";t.disabled=s,t.classList[r](o)},J=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),s=e.querySelector(t.submitButtonSelector);g(o,s,t),o.forEach(r=>{r.addEventListener("input",()=>{V(r,t),g(o,s,t)})})},G=e=>{[...document.querySelectorAll(e.formSelector)].forEach(o=>{o.addEventListener("submit",s=>s.preventDefault()),J(o,e)})},L=(e,t)=>{const o=[...e.querySelectorAll(t.inputSelector)],s=e.querySelector(t.submitButtonSelector);o.forEach((r,n)=>{A(r,n),r.value=""}),g(o,s,t)},P={baseUrl:"https://mesto.nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"6874ea7c-fdda-46c4-ad6e-6750714638d0","Content-Type":"application/json"}};async function c(e,t){return fetch(`${P.baseUrl}${e}`,{...t,headers:P.headers}).then(o=>o.ok?o.json():Promise.reject(`Ошибка ${o.status}`))}const H=()=>c("/users/me",{method:"GET"}),z=e=>c("/users/me",{method:"PATCH",body:JSON.stringify(e)}),K=e=>c("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})}),Q=()=>c("/cards",{method:"GET"}),R=e=>c("/cards",{method:"POST",body:JSON.stringify(e)}),W=e=>c(`/cards/${e}`,{method:"DELETE"}),X=e=>c(`/cards/likes/${e}`,{method:"DELETE"}),Y=e=>c(`/cards/likes/${e}`,{method:"PUT"}),Z=document.querySelectorAll(".popup");Z.forEach(e=>{e.classList.add("popup_is-animated"),e.addEventListener("click",t=>{(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&l(e)})});const ee=document.querySelector(".profile__edit-button"),te=document.querySelector(".profile__title"),oe=document.querySelector(".profile__description"),O=document.querySelector(".profile__image"),m=document.querySelector(".popup_type_edit"),d=m.querySelector(".popup__form"),T=m.querySelector(".popup__button"),q=d.querySelector(".popup__input_type_name"),C=d.querySelector(".popup__input_type_description");ee.addEventListener("click",function(){L(d,v),q.value=globalThis.userData.name,C.value=globalThis.userData.about;const e=new InputEvent("input",{inputType:"insertText"});q.dispatchEvent(e),C.dispatchEvent(e),_(m)});async function re(e){e.preventDefault();try{T.textContent="Сохранение...";const t=await z({name:q.value,about:C.value});E(t)}catch(t){console.error("Ошибка при редактировании профиля:",t)}finally{T.textContent="Сохранить",d.reset(),l(m)}}function E(e){globalThis.userData=e,te.textContent=e.name,oe.textContent=e.about,O.style.backgroundImage=`url(${e.avatar})`}d.addEventListener("submit",re);const y=document.querySelector(".popup_type_edit-profile-image"),f=y.querySelector(".popup__form"),x=y.querySelector(".popup__button"),ne=f.querySelector(".popup__input_type_url_image");O.addEventListener("click",function(){L(f,v),_(y)});async function se(e){e.preventDefault();try{x.textContent="Сохранение...";const t=await K(ne.value);E(t)}catch(t){console.error("Ошибка при редактировании аватара профиля:",t)}finally{x.textContent="Сохранить",f.reset(),l(y)}}f.addEventListener("submit",se);const ce=document.querySelector(".profile__add-button"),S=document.querySelector(".popup_type_new-card"),u=S.querySelector(".popup__form"),w=S.querySelector(".popup__button"),ae=u.querySelector(".popup__input_type_card-name"),ie=u.querySelector(".popup__input_type_url");ce.addEventListener("click",()=>_(S));async function ue(e){e.preventDefault();try{w.textContent="Сохранение...";const t=await R({name:ae.value,link:ie.value});$(t)}catch(t){console.error("Ошибка при создании карточки:",t)}finally{w.textContent="Сохранить",l(S),u.reset(),L(u,v)}}u.addEventListener("submit",ue);const k=document.querySelector(".popup_type_image"),B=k.querySelector(".popup__image"),le=k.querySelector(".popup__caption");function de(e){B.src=e.src,B.alt=e.alt,le.textContent=e.alt,_(k)}const pe=document.querySelector(".places__list");function $(e){const t=F({data:e,deleteCard:W,likeCard:Y,openImage:de,unlikeCard:X});pe.prepend(t)}function _e(e){e.reverse().forEach($)}const v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};G(v);Promise.all([Q(),H()]).then(([e,t])=>{E(t),_e(e)}).catch(console.error);
