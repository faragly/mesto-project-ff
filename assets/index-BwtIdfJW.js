(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const $=document.querySelector("#card-template").content.querySelector(".card"),S=e=>e.some(({_id:t})=>t===globalThis.userData._id),I=(e,t)=>{const r=e.querySelector(".card__like-button"),s=e.querySelector(".card__like-count"),o=S(t)?"add":"remove";s.textContent=t.length,r.classList[o]("card__like-button_is-active")};function N({data:e,deleteCard:t,openImage:r,likeCard:s,unlikeCard:o}){const n=$.cloneNode(!0),i=n.querySelector(".card__like-button"),B=n.querySelector(".card__title"),p=n.querySelector(".card__image");if(p.src=e.link,B.textContent=e.name,p.alt=e.name,I(n,e.likes),globalThis.userData._id===e.owner._id){const a=n.querySelector(".card__delete-button");a.classList.add("card__delete-button_visible"),a.addEventListener("click",async()=>{if(!confirm("Вы действительно хотите удалить карточку?")){console.warn(`Удаление карточки с id ${e._id} отменено.`);return}try{const{message:f}=await t(e._id);n.remove(),console.log(`%c${f}`,"color: green")}catch(f){console.error("Произошла ошибка при удалении карточки:",f)}})}return p.addEventListener("click",()=>r(p)),i.addEventListener("click",async()=>{try{const{likes:a}=S(e.likes)?await o(e._id):await s(e._id);e.likes=a,I(n,a)}catch(a){console.error(`Произошла ошибка при ${S?"удалении лайка с":"лайке"} карточки:`,a)}}),n}function m(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",w)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",w)}function w(e){if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");u(t)}}const U=(e,t,r)=>{const s=e.nextElementSibling;e.classList.add(r.inputErrorClass),s.classList.add(r.errorClass),s.textContent=t},D=(e,t)=>{const r=e.nextElementSibling;e.classList.remove(t.inputErrorClass),r.classList.remove(t.errorClass),r.textContent=""},M=(e,t)=>{const{patternMismatch:r,valid:s}=e.validity,o=r?e.dataset.errorMessage:"";e.setCustomValidity(o),s?D(e,t):U(e,e.validationMessage,t)},h=(e,t,{inactiveButtonClass:r})=>{const s=e.some(({validity:{valid:n}})=>!n),o=s?"add":"remove";t.disabled=s,t.classList[o](r)},F=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),s=e.querySelector(t.submitButtonSelector);h(r,s,t),r.forEach(o=>{o.addEventListener("input",()=>{M(o,t),h(r,s,t)})})},j=e=>{[...document.querySelectorAll(e.formSelector)].forEach(r=>{r.addEventListener("submit",s=>s.preventDefault()),F(r,e)})},g=(e,t)=>{const r=[...e.querySelectorAll(t.inputSelector)],s=e.querySelector(t.submitButtonSelector);r.forEach((o,n)=>{D(o,n),o.value=""}),h(r,s,t)},T={baseUrl:"https://mesto.nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"6874ea7c-fdda-46c4-ad6e-6750714638d0","Content-Type":"application/json"}};async function c(e,t){return fetch(`${T.baseUrl}${e}`,{...t,headers:T.headers}).then(r=>r.ok?r.json():Promise.reject(`Ошибка ${r.status}`))}const V=()=>c("/users/me",{method:"GET"}),J=e=>c("/users/me",{method:"PATCH",body:JSON.stringify(e)}),G=e=>c("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})}),H=()=>c("/cards",{method:"GET"}),z=e=>c("/cards",{method:"POST",body:JSON.stringify(e)}),K=e=>c(`/cards/${e}`,{method:"DELETE"}),Q=e=>c(`/cards/likes/${e}`,{method:"DELETE"}),R=e=>c(`/cards/likes/${e}`,{method:"PUT"}),W=document.querySelectorAll(".popup");W.forEach(e=>{e.classList.add("popup_is-animated"),e.addEventListener("click",t=>{(t.target===t.currentTarget||t.target.classList.contains("popup__close"))&&u(e)})});const X=document.querySelector(".profile__edit-button"),Y=document.querySelector(".profile__title"),Z=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),L=document.querySelector(".popup_type_edit"),d=L.querySelector(".popup__form"),v=d.querySelector(".popup__input_type_name"),b=d.querySelector(".popup__input_type_description");X.addEventListener("click",function(){g(d,y),v.value=globalThis.userData.name,b.value=globalThis.userData.about;const e=new InputEvent("input",{inputType:"insertText"});v.dispatchEvent(e),b.dispatchEvent(e),m(L)});async function ee(e){e.preventDefault();try{const t=await J({name:v.value,about:b.value});q(t)}catch(t){console.error("Ошибка при редактировании профиля:",t)}finally{d.reset(),u(L)}}function q(e){globalThis.userData=e,Y.textContent=e.name,Z.textContent=e.about,x.style.backgroundImage=`url(${e.avatar})`}d.addEventListener("submit",ee);const E=document.querySelector(".popup_type_edit-profile-image"),_=E.querySelector(".popup__form"),te=_.querySelector(".popup__input_type_url_image");x.addEventListener("click",function(){g(_,y),m(E)});async function re(e){e.preventDefault();try{const t=await G(te.value);q(t)}catch(t){console.error("Ошибка при редактировании аватара профиля:",t)}finally{_.reset(),u(E)}}_.addEventListener("submit",re);const oe=document.querySelector(".profile__add-button"),C=document.querySelector(".popup_type_new-card"),l=C.querySelector(".popup__form"),ne=l.querySelector(".popup__input_type_card-name"),se=l.querySelector(".popup__input_type_url");oe.addEventListener("click",()=>m(C));async function ce(e){e.preventDefault();try{const t=await z({name:ne.value,link:se.value});A(t)}catch(t){console.error("Ошибка при создании карточки:",t)}finally{u(C),l.reset(),g(l,y)}}l.addEventListener("submit",ce);const k=document.querySelector(".popup_type_image"),P=k.querySelector(".popup__image"),ae=k.querySelector(".popup__caption");function ie(e){P.src=e.src,P.alt=e.alt,ae.textContent=e.alt,m(k)}const le=document.querySelector(".places__list");function A(e){const t=N({data:e,deleteCard:K,likeCard:R,openImage:ie,unlikeCard:Q});le.prepend(t)}function ue(e){e.reverse().forEach(A)}const y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};j(y);Promise.all([H(),V()]).then(([e,t])=>{q(t),ue(e)}).catch(console.error);
